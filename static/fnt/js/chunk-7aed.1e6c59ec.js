(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7aed"],{E3dT:function(t,e,i){},Fn4u:function(t,e,i){"use strict";var s=i("OfXz");i.n(s).a},Gmxi:function(t,e,i){"use strict";i.r(e);var s=i("gDS+"),n=i.n(s),o=i("4d7F"),a=i.n(o),l=i("Nlzp"),d={name:"Dragger",data:function(){return{items:[],dragEl:null,dragIndex:-1}},mounted:function(){window.addEventListener("mouseup",this.onMouseUp,!1)},methods:{onMouseDown:function(t,e){var i=this;t.preventDefault(),this.dragIndex=e,this.$nextTick(function(){i.dragEl=i.$refs["item_"+e][0],window.addEventListener("mousemove",i.onMouseMove);var t=i.items[e].top,s=i.items[e].left,n=i.$refs.container;(s<0||s>n.offsetWidth||t<0||t>n.offsetHeight)&&i.dragEl.classList.add("state-inactive")})},onMouseUp:function(t){if(this.dragIndex>-1&&this.dragEl){var e=this.$refs.container,i=this.dragEl.offsetLeft/e.offsetWidth*100,s=this.dragEl.offsetTop/e.offsetHeight*100;s<0||i<0||s>100||i>100?this.inactiveItem(this.dragIndex):(this.items[this.dragIndex].left=i,this.items[this.dragIndex].top=s),this.$forceUpdate(),this.dragIndex=-1,this.dragEl=null}window.removeEventListener("mousemove",this.onMouseMove)},onMouseMove:function(t){if(this.dragEl){var e=this.$refs.container.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top;this.moveAt(i,s)}},moveAt:function(t,e){if(this.dragEl){var i=this.$refs.container;t<0||t>i.offsetWidth||e<0||e>i.offsetHeight?this.dragEl.classList.add("state-inactive"):this.dragEl.classList.remove("state-inactive"),this.dragEl.style.left=t+"px",this.dragEl.style.top=e+"px"}},addItem:function(t,e){var i=this.$refs.container,s=i.getBoundingClientRect();e.left=(t.clientX-s.left)/i.offsetWidth*100,e.top=(t.clientY-s.top)/i.offsetHeight*100,this.items.push(e),this.onMouseDown(t,this.items.length-1)},getListItems:function(){return this.items.map(function(t){return{id:t.id,top:t.top,left:t.left}})},setListItems:function(t){this.items=t,console.log(t)},inactiveItem:function(t){var e=this.items[t];this.$emit("on-inactive-item",e),this.items.splice(t,1)},setBackground:function(t){this.$refs.container.style.backgroundImage=t?"url('"+t+"')":"none"}}},r=(i("qHND"),i("KHd+")),c=Object(r.a)(d,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"container",staticClass:"position-dragger"},t._l(t.items,function(e,s){return i("el-popover",{key:e.id,attrs:{placement:"top",width:"300",trigger:"click"}},[i("div",[t._t("popover",null,{item:e})],2),t._v(" "),i("div",{ref:"item_"+s,refInFor:!0,staticClass:"control-item draggable",class:"OFF"===e.state?"state-off":"state-on",style:{top:e.top+"%",left:e.left+"%"},attrs:{slot:"reference"},on:{mousedown:function(e){t.onMouseDown(e,s)}},slot:"reference"},[t._t("itemName",[t._v("\n        "+t._s(e.dev_name)+"\n      ")],{item:e})],2)])}))},[],!1,null,"4c135c9e",null);c.options.__file="dragger.vue";var u={name:"DragPosition",components:{Dragger:c.exports,SelectMedia:i("qKYO").a},props:{data:{type:Array,default:function(){return[]}},viewId:{type:String,default:"VIEW_ADV"},model:{type:String,default:"positioncontrol/adv"}},data:function(){return{filters:{building:null},loading:{building:!1},buildings:[],floors:[],mediaId:null,selectedIndex:-1,selectedItem:{},items:{active:[],inactive:[]}}},created:function(){var t=this;this.getBuildings().then(function(e){t.buildings.length&&(t.filters.building=t.buildings[0].id,t.getFloors())}).catch(console.error)},mounted:function(){},methods:{getBuildings:function(t){var e=this;return new a.a(function(i,s){e.loading.building=!0,Object(l.c)("buildings",{bdg_name__icontains:t}).then(function(t){return e.buildings=t.results,e.loading.building=!1,i(!0)}).catch(function(t){return console.error(t),e.loading.building=!1,s(!1)})})},getFloors:function(){var t=this;return this.loading.floor=!0,new a.a(function(e,i){Object(l.c)(t.model,{flr_building:t.filters.building}).then(function(i){return i.results?t.floors=i.results:t.floors=i,t.floors.length?t.selectFloor(0):(t.selectedIndex=-1,t.selectedItem=null),t.loading.floor=!1,e(!0)}).catch(function(e){return console.error(e),t.loading.floor=!1,i(!1)})})},selectFloor:function(t){var e=this;this.selectedIndex=t,this.selectedItem=this.floors[t],this.items.active=[],this.items.inactive=[],this.selectedItem.items.forEach(function(t){"undefined"!==t.top&&void 0!==t.left?e.items.active.push(t):e.items.inactive.push(t)}),this.$refs.dragger.setListItems(this.items.active),this.$refs.dragger.setBackground(this.selectedItem.media_src)},onMouseDownInactiveItem:function(t,e,i){this.items.inactive.splice(i,1),this.$refs.dragger.addItem(t,e)},save:function(){var t=this,e=this.$refs.dragger.getListItems();Object(l.b)({items:n()(e),pov_view_id:this.viewId,pov_building:this.filters.building,poi_data_id:this.selectedItem.id,poi_media:this.selectedItem.media_id},this.model).then(function(e){t.$notify({type:"success",message:t.$t("positioncontrol.save.success")})}).catch(function(e){console.error(e),t.$notify({type:"error",message:t.$t("positioncontrol.save.error")})})},onInactiveItem:function(t){delete t.top,delete t.left,this.items.inactive.push(t)},onChangeMedia:function(t){this.selectedItem&&(this.selectedItem.media_id=t.id,this.selectedItem.media_src=t.med_abs_url,this.$refs.dragger.setBackground(this.selectedItem.media_src))}}},v=(i("Fn4u"),Object(r.a)(u,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"dp-container"},[i("div",{staticClass:"dp-header"},[i("div",{staticClass:"dp-building"},[i("div",[t._v(t._s(t.$t("zone.chooseBuilding")))]),t._v(" "),i("el-select",{attrs:{"remote-method":t.getBuildings,loading:t.loading.building,filterable:"","reserve-keyword":"",remote:""},on:{change:function(e){t.getFloors()}},model:{value:t.filters.building,callback:function(e){t.$set(t.filters,"building",e)},expression:"filters.building"}},t._l(t.buildings,function(t){return i("el-option",{key:t.id,attrs:{label:t.bdg_name,value:t.id}})}))],1)]),t._v(" "),i("div",{staticClass:"dp-body"},[i("div",{staticClass:"dp-aside"},[t._t("aside",t._l(t.floors,function(e,s){return i("div",{key:e.id,staticClass:"floor-item",class:s===t.selectedIndex?"dp-aside-active":"",on:{click:function(e){t.selectFloor(s)}}},[t._v("\n          "+t._s(e.flr_name)+"\n        ")])}))],2),t._v(" "),i("div",{staticClass:"dp-status"},[t._t("status",[i("el-row",{attrs:{gutter:5}},t._l(t.items.inactive,function(e,s){return i("el-col",{key:e.id,attrs:{span:8}},[i("div",{staticClass:"control-item state-inactive",on:{mousedown:function(i){t.onMouseDownInactiveItem(i,e,s)}}},[t._v(t._s(e.dev_name))])])}))])],2),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.selectedIndex>=0,expression:"selectedIndex >= 0"}],staticClass:"dp-main"},[i("div",{staticClass:"dp-main-action"},[i("el-button",{staticClass:"pull-right dp-main-action-item",attrs:{size:"small",type:"success"},on:{click:t.save}},[i("svg-icon",{attrs:{"icon-class":"save"}}),t._v(" "+t._s(t.$t("core.save")))],1),t._v(" "),i("select-media",{staticClass:"pull-right dp-main-action-item",attrs:{many:!1,"youtube-import":!1,"file-type":"image","upload-extension":".png, jpg, jpeg, bmp","tooltip-class":"tooltip-hidden"},on:{triggerChanged:t.onChangeMedia},model:{value:t.mediaId,callback:function(e){t.mediaId=e},expression:"mediaId"}},[i("el-button",{attrs:{type:"success",size:"small"}},[t._v(t._s(t.$t("positioncontrol.selectbackground")))])],1)],1),t._v(" "),i("dragger",{ref:"dragger",on:{"on-inactive-item":t.onInactiveItem},scopedSlots:t._u([{key:"popover",fn:function(e){return[t._t("popover",null,{item:e.item})]}},{key:"itemName",fn:function(e){var i=e.item;return[t._t("itemName",null,{item:i})]}}])})],1)])])},[],!1,null,"2d65059c",null));v.options.__file="index.vue";var f={name:"Position",components:{DragPosition:v.exports},data:function(){return{}},methods:{}},m=(i("lkgF"),Object(r.a)(f,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container"},[i("div",{staticClass:"app-body"},[i("drag-position",{attrs:{model:"positioncontrol/adv","view-id":"VIEW_ADV"},scopedSlots:t._u([{key:"popover",fn:function(e){var s=e.item;return[i("div",{staticClass:"adv-position-popover"},[i("div",{staticClass:"adv-item"},[i("div",{staticClass:"title"},[t._v(t._s(t.$t("device.dev_name")))]),t._v(" "),i("div",{staticClass:"content"},[t._v(t._s(s.dev_name))])]),t._v(" "),i("div",{staticClass:"adv-item"},[i("div",{staticClass:"title"},[t._v(t._s(t.$t("device.dev_zone_adv")))]),t._v(" "),i("div",{staticClass:"content"},[t._v(t._s(s.dev_zone_name))])]),t._v(" "),i("div",{staticClass:"adv-item"},[i("div",{staticClass:"title"},[t._v(t._s(t.$t("device.diskspace")))]),t._v(" "),i("div",{staticClass:"content"},[t._v(t._s(s.dev_diskspace))])]),t._v(" "),i("div",{staticClass:"adv-item"},[i("div",{staticClass:"title"},[t._v(t._s(t.$t("device.mediaplay")))]),t._v(" "),i("div",{staticClass:"content"},[t._v(t._s(s.dev_mediaplay_name))])])])]}},{key:"itemName",fn:function(e){var i=e.item;return[t._v("\n        "+t._s(i.dev_name)+"\n      ")]}}])})],1)])},[],!1,null,"3dabe71c",null));m.options.__file="position.vue";e.default=m.exports},OfXz:function(t,e,i){},ZCF8:function(t,e,i){},lkgF:function(t,e,i){"use strict";var s=i("ZCF8");i.n(s).a},qHND:function(t,e,i){"use strict";var s=i("E3dT");i.n(s).a}}]);